package threadtest;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.ResultSetMetaData;
import java.util.LinkedList;
import java.util.List;


public class StockData implements Runnable {


public synchronized List getStockQuotes() throws Exception {
	List list = new LinkedList();
	Class.forName("com.mysql.jdbc.Driver");
	Connection conn =DriverManager.getConnection("jdbc:mysql://Salesdb3Admin.db.3009048.hostedresource.com/Salesdb3Admin\",\"Salesdb3Admin\",\"Welcome@77");
	PreparedStatement st= conn.prepareStatement("Select * from stock_quotes where stock_ticker=?");
	ResultSet rs	= st.executeQuery();
	ResultSetMetaData rsmd = rs.getMetaData();
	while(rs.next()){
	String stock = rs.getString(2);
	StockQuote quote = new StockQuote();
	quote.setStockTicker(stock);
		list.add(quote);
	 }
	return list;
}

public synchronized void setStockQuotes(List quote, String ticker) throws Exception{
	Class.forName("com.mysql.jdbc.Driver");
	Connection conn =DriverManager.getConnection("jdbc:mysql://Salesdb3Admin.db.3009048.hostedresource.com/Salesdb3Admin\",\"Salesdb3Admin\",\"Welcome@77");
	java.sql.PreparedStatement st=conn.prepareStatement("insert into stock_quotes "
			+ "(stock_ticker,quote_date, price) values(?,?,?)");
	for(int i=0; i<quote.size(); i++){
	StockQuote sq= (StockQuote) quote.get(i);
	st.setString(1, ticker);
	if((i+1)%100==0){
		st.addBatch();
		st.executeBatch();
	}
	}
	st.executeBatch();
}

public void run() {
	try {
		List l = getStockQuotes();
		setStockQuotes(l, "GGOL");
	} catch (Exception e) {
		// TODO Auto-generated catch block
		e.printStackTrace();
	}
	
}
}
